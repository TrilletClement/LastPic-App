<app-header title="LastPic"></app-header>
<ion-content class="simple-groups-content">
  <!-- Conteneur des groupes -->
  <div class="groups-container">
    <div class="groups-scroll" [class.has-selection]="selectedGroup">
      <!-- Groupes de l'utilisateur -->
      <div class="story-item" *ngFor="let group of userGroups" [class.selected]="selectedGroup?.id === group.id"
        [class.viewed]="isGroupViewed(group)" [class.has-content]="hasPhotos(group)" (click)="selectGroup(group)">
        <div class="story-avatar">
          <img [src]="getGroupAvatar(group)" [alt]="group.name" />
          <div class="story-ring"></div>
          <div class="content-count" *ngIf="getPhotoCount(group) > 0">
            {{ getPhotoCount(group) }}
          </div>
          <div class="add-indicator" *ngIf="selectedGroup?.id === group.id">
            <ion-icon name="camera"></ion-icon>
          </div>
          <div class="member-count" *ngIf="group.memberCount > 1">
            {{ group.memberCount }}
          </div>
        </div>
        <span class="story-username">{{ group.name }}</span>
      </div>

      <!-- Bouton pour ajouter un groupe (aligné à gauche) -->
      <div class="story-item add-group-item" (click)="createNewGroup()">
        <div class="story-avatar">
          <ion-icon name="add"></ion-icon>
        </div>
        <span class="story-username">Nouveau</span>
      </div>
    </div>
  </div>

  <!-- Message "Aucun groupe disponible" (en dehors du scroll) -->
  <div class="no-groups-message" *ngIf="!userGroups || userGroups.length === 0">
    <ion-icon name="alert-circle-outline"></ion-icon>
    <p>Aucun groupe disponible pour le moment</p>
  </div>

  <!-- Zone d'ajout de photo -->
  <div class="photo-add-section" *ngIf="selectedGroup">
    <div class="selected-story-info">
      <h3>Ajouter à {{ selectedGroup.name }}</h3>
      <p *ngIf="selectedGroup.description">{{ selectedGroup.description }}</p>
      <p *ngIf="!selectedGroup.description">{{ selectedGroup.memberCount }} membre(s)</p>
    </div>
    <div class="camera-area" (click)="openCamera()">
      <div class="camera-placeholder" *ngIf="!cameraStream && !capturedPhoto">
        <ion-icon name="camera"></ion-icon>
        <p>Touchez pour prendre une photo</p>
      </div>
      <video #videoElement class="camera-stream" [style.display]="cameraStream ? 'block' : 'none'" autoplay
        playsinline></video>
      <img [src]="capturedPhoto" *ngIf="capturedPhoto && !cameraStream" class="captured-photo" alt="Photo capturée" />
    </div>
    <div class="camera-controls" *ngIf="cameraStream">
      <ion-button class="capture-btn" (click)="capturePhoto()" fill="clear">
        <div class="capture-circle"></div>
      </ion-button>
      <ion-button class="close-btn" (click)="closeCamera()" fill="clear">
        <ion-icon name="close"></ion-icon>
      </ion-button>
    </div>
    <div class="photo-actions" *ngIf="capturedPhoto && !cameraStream">
      <ion-button (click)="retakePhoto()" fill="outline" color="medium">
        <ion-icon name="refresh"></ion-icon>
        Reprendre
      </ion-button>
      <ion-button (click)="addToGroup()" fill="solid" color="primary">
        <ion-icon name="add"></ion-icon>
        Ajouter au groupe
      </ion-button>
    </div>
  </div>

  <!-- Aucun groupe sélectionné -->
  <div class="no-selection" *ngIf="!selectedGroup && userGroups.length > 0">
    <ion-icon name="images"></ion-icon>
    <h3>Sélectionnez un groupe</h3>
    <p>Choisissez un groupe en haut pour commencer à ajouter une photo</p>
  </div>
</ion-content>